#!/bin/sh

[ "$1" = "" ] && echo "Missing IP address or UID to search log for" 1>&2 && exit 1

LOG="/var/log/zentyal-captiveportal/access.log"
SLOG="/var/log/squid3/access.log"
ip=$1
(
mb=$(grep ",$ip$" /tmp/topusers.csv | cut -d ',' -f 1)
echo "Main Log says $ip used $mb Mb."
echo -n "Squid says $ip "
less $SLOG* | grep " $ip " | awk '{s+=$5} END {printf "used %3.2f Mb.\n",s/1024/1024}'
less $LOG* | grep "^$ip " | uniq
) | less


